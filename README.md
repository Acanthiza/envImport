---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->




```r

  library(envReport)
  library(envImport)
  library(magrittr)
```

# envImport

<!-- badges: start -->
<!-- badges: end -->

The goal of envImport is to obtain, and make seamlessly useable, environmental data from disparate data sources, for a geographic area of interest.

## Installation

You can install the development version of envImport from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("Acanthiza/envImport")
```

## Supported data sources

`data_name` = 'data source'. Data sources are (usually) obvious sources of data. Examples are the Global Biodiversity Infrastructure Facility ([GBIF](https://www.gbif.org/)) via `galah` package [@R-galah] or Terrestrial Ecosystems Network ([TERN](https://www.tern.org.au/)). The 31 data sources currently supported or with plans for development are (also see `envImport::data_map`):

* : 

## General workflow

### `data_map`

The data_map (see table @ref(tab:dataMap)) provides a mapping from original data sources to the desired columns in the assembled data set.


```r

  knitr::kable(data_map
               , caption = "Data map of desired columns in the assembled data (columns) and names of columns in the original data (rows)"
               )
```



Table: Data map of desired columns in the assembled data (columns) and names of columns in the original data (rows)

|col            |class     |bio_all |bdbsa                                                                                                         |egis                                                                                       |havplot                                                                              |tern                          |alis                                                                           |bcm                                                     |ptp                                                                                                                                                                            |nvb                                                        |other                                                                                                                                                                        |galah                         |gbif                                     |
|:--------------|:---------|:-------|:-------------------------------------------------------------------------------------------------------------|:------------------------------------------------------------------------------------------|:------------------------------------------------------------------------------------|:-----------------------------|:------------------------------------------------------------------------------|:-------------------------------------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------|:----------------------------------------|
|data_name      |character |TRUE    |bdbsa                                                                                                         |egis                                                                                       |havplot                                                                              |tern                          |alis                                                                           |bcm                                                     |ptp                                                                                                                                                                            |nvb                                                        |other                                                                                                                                                                        |galah                         |gbif                                     |
|epsg           |numeric   |FALSE   |7844                                                                                                          |7844                                                                                       |4326                                                                                 |4326                          |4326                                                                           |4326                                                    |4326                                                                                                                                                                           |4326                                                       |4326                                                                                                                                                                         |4326                          |4326                                     |
|site           |character |TRUE    |PATCHID                                                                                                       |EGISCODE                                                                                   |plotName                                                                             |site_unique                   |SITENUMBER                                                                     |SITE_ID                                                 |PlantDataID                                                                                                                                                                    |path                                                       |Site                                                                                                                                                                         |locationID                    |gbifID                                   |
|date           |Date      |TRUE    |OBSDATE                                                                                                       |SIGHTINGDATE                                                                               |obsStartDate                                                                         |visit_start_date              |SurveyDate                                                                     |ASSESSMENT_DATE                                         |Obs_Date                                                                                                                                                                       |date                                                       |SIGHTINGDATE                                                                                                                                                                 |eventDate                     |eventDate                                |
|lat            |numeric   |TRUE    |LATITUDE                                                                                                      |LATITUDE                                                                                   |decimalLatitude                                                                      |latitude                      |LATITUDE                                                                       |LATITUDE                                                |LATITUDE                                                                                                                                                                       |lat                                                        |LATITUDE                                                                                                                                                                     |decimalLatitude               |decimalLatitude                          |
|long           |numeric   |TRUE    |LONGITUDE                                                                                                     |LONGITUDE                                                                                  |decimalLongitude                                                                     |longitude                     |LONGITUDE                                                                      |LONGITUDE                                               |LONGITUDE                                                                                                                                                                      |lon                                                        |LONGITUDE                                                                                                                                                                    |decimalLongitude              |decimalLongitude                         |
|original_name  |character |TRUE    |CONCATNAMAUTH                                                                                                 |SPECIES                                                                                    |scientificName                                                                       |species                       |CONCATNAMAUTH                                                                  |CONCATNAMAUTH                                           |CONCATNAMAUTH                                                                                                                                                                  |Spp                                                        |SPECIES                                                                                                                                                                      |scientificName                |scientificName                           |
|common         |character |TRUE    |COMNAME1                                                                                                      |COMNAME                                                                                    |NA                                                                                   |NA                            |COMNAME1                                                                       |COMNAME1                                                |COMNAME1                                                                                                                                                                       |NA                                                         |NA                                                                                                                                                                           |vernacularName                |NA                                       |
|nsx            |character |TRUE    |NSXCODE                                                                                                       |NSXCODE                                                                                    |NA                                                                                   |NA                            |NSXCode                                                                        |species                                                 |NSXCODE                                                                                                                                                                        |NA                                                         |NA                                                                                                                                                                           |organismID                    |NA                                       |
|occ_derivation |character |TRUE    |NUMOBSERVED                                                                                                   |NUMOBSERVED                                                                                |abundanceValue                                                                       |NA                            |NA                                                                             |NA                                                      |NA                                                                                                                                                                             |NA                                                         |NUMOBSERVED                                                                                                                                                                  |occurrenceStatus              |occurrenceStatus                         |
|quantity       |character |TRUE    |NUMOBSERVED                                                                                                   |NUMOBSERVED                                                                                |abundanceValue                                                                       |NA                            |NA                                                                             |NA                                                      |NA                                                                                                                                                                             |NA                                                         |NUMOBSERVED                                                                                                                                                                  |organismQuantity              |organismQuantity                         |
|survey_nr      |character |TRUE    |SURVEYNR                                                                                                      |SURVEYNR                                                                                   |NA                                                                                   |NA                            |NA                                                                             |NA                                                      |NA                                                                                                                                                                             |NA                                                         |SURVEYNR                                                                                                                                                                     |NA                            |NA                                       |
|survey         |character |TRUE    |SURVEYNAME                                                                                                    |SURVEYNAME                                                                                 |projectID                                                                            |NA                            |LandSystem                                                                     |NA                                                      |NA                                                                                                                                                                             |NA                                                         |SURVEYNAME                                                                                                                                                                   |datasetName                   |NA                                       |
|ind            |character |TRUE    |ISINDIGENOUS                                                                                                  |ISINDIGENOUSFLAG                                                                           |NA                                                                                   |NA                            |ISINDIGENOUS                                                                   |ISINDIGENOUS                                            |ISINDIGENOUS                                                                                                                                                                   |NA                                                         |NA                                                                                                                                                                           |NA                            |NA                                       |
|rel_metres     |character |TRUE    |rel_metres                                                                                                    |rel_metres                                                                                 |coordinateUncertaintyInMetres                                                        |NA                            |NA                                                                             |NA                                                      |NA                                                                                                                                                                             |NA                                                         |maxDist                                                                                                                                                                      |coordinateUncertaintyInMeters |coordinateUncertaintyInMeters            |
|sens           |logical   |TRUE    |NA                                                                                                            |DISTRIBDESC                                                                                |NA                                                                                   |NA                            |NA                                                                             |NA                                                      |NA                                                                                                                                                                             |NA                                                         |NA                                                                                                                                                                           |NA                            |NA                                       |
|lifeform       |character |TRUE    |MUIRCODE                                                                                                      |NA                                                                                         |NA                                                                                   |lifeform                      |Lifeform                                                                       |NA                                                      |Life_form                                                                                                                                                                      |NA                                                         |NA                                                                                                                                                                           |NA                            |NA                                       |
|lifespan       |character |TRUE    |LIFESPAN                                                                                                      |NA                                                                                         |NA                                                                                   |NA                            |LIFESPAN                                                                       |LIFESPAN                                                |LIFESPAN                                                                                                                                                                       |NA                                                         |NA                                                                                                                                                                           |NA                            |NA                                       |
|cover          |numeric   |TRUE    |COVER                                                                                                         |NA                                                                                         |cover                                                                                |cover                         |Cover                                                                          |NA                                                      |NA                                                                                                                                                                             |NA                                                         |NA                                                                                                                                                                           |NA                            |NA                                       |
|cover_code     |character |TRUE    |COVCODE                                                                                                       |NA                                                                                         |NA                                                                                   |NA                            |NA                                                                             |NA                                                      |Cover_abundance                                                                                                                                                                |NA                                                         |NA                                                                                                                                                                           |NA                            |NA                                       |
|height         |numeric   |TRUE    |NA                                                                                                            |NA                                                                                         |NA                                                                                   |height                        |NA                                                                             |NA                                                      |NA                                                                                                                                                                             |NA                                                         |NA                                                                                                                                                                           |NA                            |NA                                       |
|quad_metres    |numeric   |TRUE    |quad_metres                                                                                                   |NA                                                                                         |quad_metres                                                                          |quad_metres                   |NA                                                                             |quad_metres                                             |NA                                                                                                                                                                             |NA                                                         |NA                                                                                                                                                                           |NA                            |NA                                       |
|epbc_status    |character |TRUE    |ESACTSTATUSCODE                                                                                               |ESACTSTATUSCODE                                                                            |NA                                                                                   |NA                            |ESACTSTATUSCODE                                                                |ESACTSTATUSCODE                                         |ESACTSTATUSCODE                                                                                                                                                                |NA                                                         |NA                                                                                                                                                                           |NA                            |NA                                       |
|npw_status     |character |TRUE    |NPWACTSTATUSCODE                                                                                              |NPWACTSTATUSCODE                                                                           |NA                                                                                   |NA                            |NPWACTSTATUSCODE                                                               |NPWACTSTATUSCODE                                        |NPWACTSTATUSCODE                                                                                                                                                               |NA                                                         |NA                                                                                                                                                                           |NA                            |NA                                       |
|method         |character |TRUE    |METHODDESC                                                                                                    |METHODDESC                                                                                 |abundanceMethod                                                                      |NA                            |NA                                                                             |NA                                                      |NA                                                                                                                                                                             |NA                                                         |METHODDESC                                                                                                                                                                   |samplingProtocol              |samplingProtocol                         |
|obs            |character |TRUE    |observer                                                                                                      |OBSERVER                                                                                   |individualName                                                                       |observer_veg                  |observer                                                                       |assessor                                                |Observers                                                                                                                                                                      |assessor                                                   |observer                                                                                                                                                                     |recordedBy                    |recordedBy                               |
|denatured      |character |FALSE   |NA                                                                                                            |NA                                                                                         |NA                                                                                   |NA                            |NA                                                                             |NA                                                      |NA                                                                                                                                                                             |NA                                                         |NA                                                                                                                                                                           |generalisationInMetres        |informationWithheld                      |
|kingdom        |kingdom   |TRUE    |kingdom                                                                                                       |kingdom                                                                                    |kingdom                                                                              |kingdom                       |kingdom                                                                        |kingdom                                                 |kingdom                                                                                                                                                                        |kingdom                                                    |kingdom                                                                                                                                                                      |kingdom                       |kingdom                                  |
|desc           |character |FALSE   |Biological databases of South Australia                                                                       |Occurrence datasets from the environmental databases of South Australia (e.g. supertables) |Harmonised Australian Vegetation Plot dataset                                        |Terrestrial ecosystem network |Arid lands information system                                                  |Bushland condition monitoring                           |Paddock tree project                                                                                                                                                           |DEW Native Vegetation Branch                               |Other private datasets: SA Bird Atlas (UOA/Birds SA), Birdlife Australia Birdata portal, MLR Extra Bandicoot data, KI Post Fire Bird Monitoring, SA Seed Conservation Centre |Atlas of Living Australia     |Global biodiversity information facility |
|url            |character |FALSE   |https://www.environment.sa.gov.au/topics/science/information-and-data/biological-databases-of-south-australia |https://data.sa.gov.au/data/dataset/enviro-data-sa-website                                 |https://researchdata.edu.au/harmonised-australian-vegetation-dataset-havplot/1950860 |https://www.tern.org.au/      |https://www.pir.sa.gov.au/aghistory/natural_resources/pastoral_land_management |https://www.ncssa.asn.au/bushland-health-and-condition/ |https://treesforlife.org.au/TFLWeb/TFLWeb/What_we_do/Projects/Paddock-Tree-Projects.aspx#:~:text=Mount%20Lofty%20Ranges%20Paddock%20Tree,whose%20numbers%20are%20in%20decline. |https://www.environment.sa.gov.au/topics/native-vegetation |NA                                                                                                                                                                           |https://www.ala.org.au/       |https://www.gbif.org/                    |
|order          |character |FALSE   |1                                                                                                             |2                                                                                          |3                                                                                    |4                             |5                                                                              |6                                                       |7                                                                                                                                                                              |8                                                          |9                                                                                                                                                                            |10                            |11                                       |



`get_x` functions get data from the data source `x`. Results are always saved to disk (as getting data can be slow). When run again, they load from the saved file by default. If available, `get_x` functions use any R packages and functions provided by the data source (e.g. TERN provides `ausplotsR` [@]). The first arguments to `get_x` functions are always:

* `aoi`: an area of interest, provided as simple feature. `get_x` will turn any `aoi` into a bounding box and convert to coordinates appropriate for data source `x`. [Ed: is `aoi` always required?]
* `save_dir`: a directory to save the results to. The default (`NULL`) leads to the file `here::here("out", "ds", "x.rds")` being created and used as `save_file`. `ds` is for 'data source'. While the saved file is usually `x.rds`, in some instances it follows the format and naming of the download from `x` (e.g. GBIF data comes in a `.zip` file named by the corresponding download key).
* `get_new`: an override to force `get_x` to requery the data source, even if save_file already exists
* `...`: the dots are passed to any underlying 'native' function, such as `rgbif::occ_download()` or `ausplotsR::get_ausplots()`

Many of the `get_x` functions will only work within `DEW`.

As of June 2024, `get_x` functions can be run from `get_data`.
